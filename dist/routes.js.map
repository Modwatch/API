{"version":3,"sources":["routes.js"],"names":["Modlist","require","supportedFiletypes","validFiletype","filetype","indexOf","tokenEnsureAuthorized","req","res","next","bearerToken","bearerHeader","headers","authorization","bearer","split","token","sendStatus","module","exports","app","jwt","scriptVersion","get","find","_id","err","_modlists","set","send","length","writeHead","end","username","timestamp","score","_mods","mods","i","j","params","filetypeJSON","findOne","_list","shrinkArrays","setHeader","JSON","stringify","textList","push","join","tag","enb","badge","game","plugins","modlist","ini","prefsini","skse","enblocal","arr","users","fileLower","toReturn","queryLower","querystring","toLowerCase","post","verify","body","process","env","JWTSECRET","decoded","user","validPassword","password","pic","sign","expiresInMinutes","save","saveErr","saveUser","json","findErr","statusCode","jwtVerifyErr","write","votee","voterFindErr","voter","voterInfo","votedOnUser","upvoted","findVoteeErr","index","voteeSaveErr","votedon","saveVoterErr","console","log","profileToRemove","profile","remove","_modlist","list","modlisttxt","skyrimini","skyrimprefsini","undefined","Date","now","generateHash","updateFile"],"mappings":"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","file":"routes.js","sourcesContent":["var Modlist = require(\"./modlist.js\");\n\nvar supportedFiletypes = [\n\t\"plugins\",\n\t\"modlist\",\n\t\"ini\",\n\t\"prefsini\",\n\t\"skse\",\n\t\"enblocal\"\n];\n\nvar validFiletype = function validFileType(filetype) { \"use strict\";\n\treturn supportedFiletypes.indexOf(filetype) >= 0;\n};\n\nvar tokenEnsureAuthorized = function tokenEnsureAuthorized(req, res, next) { \"use strict\";\n\n\tvar bearerToken;\n\tvar bearerHeader = req.headers.authorization;\n\tif (typeof bearerHeader !== \"undefined\") {\n\t\tvar bearer = bearerHeader.split(\" \");\n\t\tbearerToken = bearer[1];\n\t\treq.token = bearerToken;\n\t\tnext();\n\t} else {\n\t\tres.sendStatus(403);\n\t}\n};\n\nmodule.exports = function(app, jwt, scriptVersion) { \"use strict\";\n\n  /**\n   *  Will need routes for option on each when token auth comes in\n   */\n\n\tapp.get(\"/api/users/count\", function(req, res) {\n\t\tModlist.find({}, {_id: 1}, function(err, _modlists) {\n\t\t\tif(_modlists) {\n\t\t\t\tres.set(\"Content-Type\", \"text/plain\");\n\t\t\t\tres.send(\"\" + _modlists.length);\n\t\t\t} else {\n\t\t\t\tres.writeHead(404);\n\t\t\t\tres.end();\n\t\t\t}\n\t\t});\n\t});\n\tapp.get(\"/api/users/list\", function(req, res) {\n\t\tModlist.find({}, {username: 1, timestamp: 1, score: 1}, function(err, _mods) {\n\t\t\tvar mods = [];\n\t\t\tfor(var i = _mods.length - 1, j = 0; i >= 0; i--, j++) {\n\t\t\t\tmods[j] = {\"username\": _mods[i].username, \"score\": _mods[i].score, \"timestamp\": _mods[i].timestamp};\n\t\t\t}\n\t\t\tres.set(\"Content-Type\", \"application/json\");\n\t\t\tres.send(mods);\n\t\t});\n\t});\n\tapp.get(\"/api/script/version\", function(req, res) {\n\t\tres.set(\"Content-Type\", \"text/plain\");\n\t\tres.end(scriptVersion[\"0.2\"]);\n\t});\n\tapp.get(\"/api/script/version/3\", function(req, res) {\n\t\tres.set(\"Content-Type\", \"text/plain\");\n\t\tres.end(scriptVersion[\"0.3\"]);\n\t});\n\tapp.get(\"/api/user/:username/file/:filetype\", function(req, res) {\n\t\tif(validFiletype(req.params.filetype)) {\n\t\t\tvar filetypeJSON = {};\n\t\t\tfiletypeJSON[req.params.filetype] = 1;\n\t\t\tModlist.findOne({username: req.params.username}, filetypeJSON, function(err, _list) {\n\t\t\t\tif(!_list) {\n\t\t\t\t\tres.writeHead(404);\n\t\t\t\t\tres.end();\n\t\t\t\t} else {\n\t\t\t\t\t_list.shrinkArrays();\n\t\t\t\t\tres.setHeader(\"Content-Type\", \"application/json\");\n\t\t\t\t\tres.end(JSON.stringify(_list[req.params.filetype]));\n\t\t\t\t}\n\t\t\t});\n\t\t} else {\n\t\t\tres.sendStatus(500);\n\t\t}\n\t});\n\tapp.get(\"/api/user/:username/rawfile/:filetype\", function(req, res) {\n\t\tif (validFiletype(req.params.filetype)) {\n\t\t\tvar filetypeJSON = {};\n\t\t\tfiletypeJSON[req.params.filetype] = 1;\n\t\t\tModlist.findOne({\n\t\t\t\tusername: req.params.username\n\t\t\t}, filetypeJSON, function(err, _list) {\n\t\t\t\tif (!_list) {\n\t\t\t\t\tres.writeHead(404);\n\t\t\t\t\tres.end();\n\t\t\t\t} else {\n\t\t\t\t\t_list.shrinkArrays();\n\t\t\t\t\tres.setHeader(\"Content-Type\", \"text/plain\");\n\t\t\t\t\tvar textList = [];\n\t\t\t\t\tfor(var i = 0; i < _list[req.params.filetype].length; i++) {\n\t\t\t\t\t\ttextList.push(_list[req.params.filetype][i]);\n\t\t\t\t\t}\n\t\t\t\t\tres.end(textList.join(\"\\n\"));\n\t\t\t\t}\n\t\t\t});\n\t\t} else {\n\t\t\tres.sendStatus(500);\n\t\t}\n\t});\n\tapp.get(\"/api/user/:username/profile\", function(req, res) {\n\t\tModlist.findOne({username: req.params.username}, {tag: 1, enb: 1, badge: 1, timestamp: 1, game: 1, score: 1, _id: 0}, function(err, _list) {\n\t\t\tif(!_list) {\n\t\t\t\tres.writeHead(404);\n\t\t\t\tres.end();\n\t\t\t} else {\n\t\t\t\tres.setHeader(\"Content-Type\", \"application/json\");\n\t\t\t\tres.end(JSON.stringify(_list));\n\t\t\t}\n\t\t});\n\t});\n\tapp.get(\"/api/user/:username/files\", function(req, res) {\n\t\tModlist.findOne({username: req.params.username}, {plugins: 1, modlist: 1, ini: 1, prefsini: 1, skse: 1, enblocal: 1, _id: 0}, function(err, _list) {\n\t\t\tif(!_list) {\n\t\t\t\tres.writeHead(404);\n\t\t\t\tres.end();\n\t\t\t} else {\n\t\t\t\tres.setHeader(\"Content-Type\", \"application/json\");\n\t\t\t\tvar arr = [];\n\t\t\t\tif(_list.plugins.length > 0) {\n\t\t\t\t\tarr.push(\"plugins\");\n\t\t\t\t} if(_list.modlist.length > 0) {\n\t\t\t\t\tarr.push(\"modlist\");\n\t\t\t\t} if(_list.ini.length > 0) {\n\t\t\t\t\tarr.push(\"ini\");\n\t\t\t\t} if(_list.prefsini.length > 0) {\n\t\t\t\t\tarr.push(\"prefsini\");\n\t\t\t\t} if(_list.skse.length > 0) {\n\t\t\t\t\tarr.push(\"skse\");\n\t\t\t\t} if(_list.enblocal.length > 0) {\n\t\t\t\t\tarr.push(\"enblocal\");\n\t\t\t\t}\n\t\t\t\tres.end(JSON.stringify(arr));\n\t\t\t}\n\t\t});\n\t});\n\tapp.get(\"/api/search/file/:filetype/:querystring\", function(req, res) {\n\t\tif(validFiletype(req.params.filetype)) {\n\t\t\tvar filetypeJSON = {username: 1};\n\t\t\tfiletypeJSON[req.params.filetype] = 1;\n\t\t\tModlist.find({}, filetypeJSON, function(err, users) {\n\t\t\t\tvar toReturn = [];\n\t\t\t\tvar queryLower = req.params.querystring.toLowerCase();\n\t\t\t\tvar fileLower;\n\t\t\t\tfor(var i = 0; users && i < users.length; i++) {\n\t\t\t\t\tusers[i].shrinkArrays();\n\t\t\t\t\tfor(var j = 0; j < users[i][req.params.filetype].length; j++) {\n\t\t\t\t\t\tfileLower = users[i][req.params.filetype][j].toLowerCase();\n\t\t\t\t\t\tif(fileLower.indexOf(queryLower) >= 0) {\n\t\t\t\t\t\t\ttoReturn.push(users[i].username);\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tres.setHeader(\"Content-Type\", \"application/json\");\n\t\t\t\tres.end(JSON.stringify({users: toReturn, length: toReturn.length}));\n\t\t\t});\n\t\t} else {\n\t\t\tres.sendStatus(500);\n\t\t}\n\n  });\n  /*app.get(\"/api/search/timestamp/:from/:to\", function(req, res) {\n    Modlist.find({}, {username: 1, timestamp: 1}, function(err, users) {\n        var toReturn = [];\n        for(var i = 0; users && i < users.length; i++) {\n          toReturn.push(users[i].timestamp > );\n        }\n        res.setHeader(\"Content-Type\", \"application/json\");\n        res.end(JSON.stringify({users: toReturn, length: toReturn.length}));\n    });\n  });*/\n\n  app.post(\"/auth/checkToken\", function(req, res) {\n    jwt.verify(req.body.token, process.env.JWTSECRET, function(err, decoded) {\n      if(err) {\n        res.writeHead(403);\n        res.end();\n      } else {\n        res.setHeader(\"Content-Type\", \"application/json\");\n\t\t\t\tres.end(JSON.stringify({\"username\": decoded.username}));\n      }\n    });\n  });\n\n  app.post(\"/auth/signin\", function(req, res) {\n    Modlist.findOne({\"username\": req.body.username}, function(err, user) {\n      if(err) {\n        res.writeHead(500);\n        res.end();\n      } else {\n        if(user && user.validPassword(req.body.password)) {\n          user.pic = jwt.sign({\"username\": user.username, \"password\": user.password}, process.env.JWTSECRET, {expiresInMinutes: 720});\n          user.save(function(saveErr, saveUser) {\n            if(saveErr) {\n              res.writeHead(500);\n              res.end();\n            } else {\n              res.json({token: saveUser.pic});\n            }\n          });\n        } else {\n          //console.log(req.body.username);\n          res.writeHead(403);\n          res.end();\n        }\n      }\n    });\n  });\n\n  app.post(\"/api/newTag/:username\", tokenEnsureAuthorized, function(req, res) {\n\t\tjwt.verify(req.token, process.env.JWTSECRET, function(err, decoded) {\n\t\t\tif(err) {\n\t\t\t\tres.writeHead(403);\n\t\t\t\tres.end();\n\t\t\t} else {\n\t\t\t\tModlist.findOne({username: req.params.username}, function(findErr, _list) {\n\t\t\t\t\tif(_list) {\n\t\t\t\t\t\t_list.tag = req.body.tag;\n\t\t\t\t\t\t_list.save(function(saveErr) {\n\t\t\t\t\t\t\tif(saveErr) {\n\t\t\t\t\t\t\t\tres.writeHead(500);\n\t\t\t\t\t\t\t\tres.end();\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tres.statusCode = 200;\n\t\t\t\t\t\t\t\tres.end();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t} else {\n\t\t\t\t\t\tres.writeHead(404);\n\t\t\t\t\t\tres.end();\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t});\n\tapp.post(\"/api/newENB/:username\", tokenEnsureAuthorized, function(req, res) {\n\t\tjwt.verify(req.token, process.env.JWTSECRET, function(err, decoded) {\n\t\t\tif(err) {\n\t\t\t\tres.writeHead(403);\n\t\t\t\tres.end();\n\t\t\t} else {\n\t\t\t\tModlist.findOne({username: req.params.username}, function(findErr, _list) {\n\t\t\t\t\tif(_list) {\n\t\t\t\t\t\t_list.enb = req.body.enb;\n\t\t\t\t\t\t_list.save(function(saveErr) {\n\t\t\t\t\t\t\tif(saveErr) {\n\t\t\t\t\t\t\t\tres.writeHead(500);\n\t\t\t\t\t\t\t\tres.end();\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tres.statusCode = 200;\n\t\t\t\t\t\t\t\tres.end();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t} else {\n\t\t\t\t\t\tres.writeHead(404);\n\t\t\t\t\t\tres.end();\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t});\n\tapp.post(\"/auth/upvote/:votee\", tokenEnsureAuthorized, function(req, res) {\n\t\tjwt.verify(req.token, process.env.JWTSECRET, function(jwtVerifyErr, decoded) {\n\t\t\tif(jwtVerifyErr) {\n\t\t\t\tres.writeHead(403);\n\t\t\t\tres.write(\"jwt verification error\");\n\t\t\t\tres.end();\n\t\t\t} else if(decoded.username === req.params.votee) {\n\t\t\t\tres.writeHead(403);\n\t\t\t\tres.write(\"You can't vote for yourself\");\n\t\t\t\tres.end();\n\t\t\t} else if(decoded) {\n\t\t\t\tModlist.findOne({\"username\": decoded.username}, function(voterFindErr, voter) {\n\t\t\t\t\tvar voterInfo = voter.votedOnUser(req.params.votee);\n\t\t\t\t\tif(voter && !voterInfo.upvoted) {\n\t\t\t\t\t\tModlist.findOne({\"username\": req.params.votee}, function(findVoteeErr, votee) {\n\t\t\t\t\t\t\tif(votee) {\n\t\t\t\t\t\t\t\tif(voterInfo.index === -1) {\n\t\t\t\t\t\t\t\t\tvotee.score += 1;\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tvotee.score += 2;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tvotee.save(function saveVotee(voteeSaveErr) {\n\t\t\t\t\t\t\t\t\tif(voteeSaveErr) {\n\t\t\t\t\t\t\t\t\t\tres.writeHead(500);\n\t\t\t\t\t\t\t\t\t\tres.write(\"Error saving votee info\");\n\t\t\t\t\t\t\t\t\t\tres.end();\n\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\tres.setHeader(\"Content-Type\", \"application/json\");\n\t\t\t\t\t\t\t\t\t\tres.end(JSON.stringify({\"score\": votee.score}));\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\tif(voterInfo.index !== -1) {\n\t\t\t\t\t\t\t\t\tvoter.votedon[voterInfo.index].upvoted = true;\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tvoter.votedon.push({\"username\": req.params.votee, \"upvoted\": true});\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tvoter.save(function saveVoter(saveVoterErr) {\n\t\t\t\t\t\t\t\t\tif(saveVoterErr) {\n\t\t\t\t\t\t\t\t\t\tconsole.log(saveVoterErr);\n\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\tconsole.log(\"Saved voter.votedon\");\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tres.writeHead(404);\n\t\t\t\t\t\t\t\tres.write(\"jwt verification error\");\n\t\t\t\t\t\t\t\tres.end();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t} else {\n\t\t\t\t\t\tres.writeHead(403);\n\t\t\t\t\t\tif(!voter) {\n\t\t\t\t\t\t\tres.write(\"Voter not found\");\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tres.write(\"Voter already voted\");\n\t\t\t\t\t\t}\n\t\t\t\t\t\tres.end();\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tres.writeHead(403);\n\t\t\t\tres.write(\"Voter not found\");\n\t\t\t\tres.end();\n\t\t\t}\n\t\t});\n\t});\n\tapp.post(\"/auth/downvote/:votee\", tokenEnsureAuthorized, function(req, res) {\n\t\tjwt.verify(req.token, process.env.JWTSECRET, function(jwtVerifyErr, decoded) {\n\t\t\tif(jwtVerifyErr) {\n\t\t\t\tres.writeHead(403);\n\t\t\t\tres.write(\"jwt verification error\");\n\t\t\t\tres.end();\n\t\t\t} else if(decoded.username === req.params.votee) {\n\t\t\t\tres.writeHead(403);\n\t\t\t\tres.write(\"Why would you downvote yourself?\");\n\t\t\t\tres.end();\n\t\t\t} else if(decoded) {\n\t\t\t\tModlist.findOne({\"username\": decoded.username}, function(voterFindErr, voter) {\n\t\t\t\t\tvar voterInfo = voter.votedOnUser(req.params.votee);\n\t\t\t\t\tif(voter && (voterInfo.index === -1 || voterInfo.upvoted)) {\n\t\t\t\t\t\tModlist.findOne({\"username\": req.params.votee}, function(findVoteeErr, votee) {\n\t\t\t\t\t\t\tif(votee) {\n\t\t\t\t\t\t\t\tif(voterInfo.index === -1) {\n\t\t\t\t\t\t\t\t\tvotee.score -= 1;\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tvotee.score -= 2;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tvotee.save(function saveVotee(voteeSaveErr) {\n\t\t\t\t\t\t\t\t\tif(voteeSaveErr) {\n\t\t\t\t\t\t\t\t\t\tres.writeHead(500);\n\t\t\t\t\t\t\t\t\t\tres.write(\"Error saving votee info\");\n\t\t\t\t\t\t\t\t\t\tres.end();\n\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\tres.setHeader(\"Content-Type\", \"application/json\");\n\t\t\t\t\t\t\t\t\t\tres.end(JSON.stringify({\"score\": votee.score}));\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\tif(voterInfo.index !== -1) {\n\t\t\t\t\t\t\t\t\tvoter.votedon[voterInfo.index].upvoted = false;\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tvoter.votedon.push({\"username\": req.params.votee, \"upvoted\": false});\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tvoter.save(function saveVoter(saveVoterErr) {\n\t\t\t\t\t\t\t\t\tif(saveVoterErr) {\n\t\t\t\t\t\t\t\t\t\tconsole.log(saveVoterErr);\n\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\tconsole.log(\"Saved voter.votedon\");\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tres.writeHead(404);\n\t\t\t\t\t\t\t\tres.write(\"jwt verification error\");\n\t\t\t\t\t\t\t\tres.end();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t} else {\n\t\t\t\t\t\tres.writeHead(403);\n\t\t\t\t\t\tif(!voter) {\n\t\t\t\t\t\t\tres.write(\"Voter not found\");\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tres.write(\"Voter already voted\");\n\t\t\t\t\t\t}\n\t\t\t\t\t\tres.end();\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tres.writeHead(403);\n\t\t\t\tres.write(\"Voter not found\");\n\t\t\t\tres.end();\n\t\t\t}\n\t\t});\n\t});\n\tapp.post(\"auth/remove/:username\", function(req, res) {\n\t\tconsole.log(\"hit the route?\");\n\t\tconst profileToRemove = Modlist.findOne({username: req.params.username}, function(err, profile) {\n\t\t\tif(profile && profile.validPassword(req.body.password)) {\n\t\t\t\tprofileToRemove.remove();\n\t\t\t\tres.writeHead(200);\n\t\t\t\tres.end();\n\t\t\t} else {\n\t\t\t\tres.writeHead(403);\n\t\t\t\tres.end();\n\t\t\t}\n\t\t});\n\t});\n\tapp.post(\"/loadorder\", function(req, res) {\n\t\tModlist.findOne({\"username\": req.body.username}, function(err, _modlist) {\n\t\t\tif(_modlist) { // if the username exists in the db\n\t\t\t\tif(_modlist.validPassword(req.body.password)) {\n\t\t\t\t\tif(_modlist.list || _modlist.modlisttxt || _modlist.skyrimini || _modlist.skyrimprefsini) {\n\t\t\t\t\t\t_modlist.list = undefined;\n\t\t\t\t\t\t_modlist.modlisttxt = undefined;\n\t\t\t\t\t\t_modlist.skyrimini = undefined;\n\t\t\t\t\t\t_modlist.skyrimprefsini = undefined;\n\t\t\t\t\t}\n\t\t\t\t\t_modlist.plugins = req.body.plugins;\n\t\t\t\t\t_modlist.modlist = req.body.modlist;\n\t\t\t\t\t_modlist.ini = req.body.ini;\n\t\t\t\t\t_modlist.prefsini = req.body.prefsini;\n\t\t\t\t\t_modlist.skse = req.body.skse;\n\t\t\t\t\t_modlist.enblocal = req.body.enblocal;\n\t\t\t\t\t_modlist.enb = req.body.enb;\n\t\t\t\t\t_modlist.game = req.body.game;\n\t\t\t\t\t_modlist.tag = req.body.tag;\n\t\t\t\t\t_modlist.timestamp = Date.now();\n\t\t\t\t\t_modlist.save(function(saveErr) {\n\t\t\t\t\t\tif(saveErr) {\n\t\t\t\t\t\t\tres.statusCode = 500;\n\t\t\t\t\t\t\tres.write(\"Saving to server failed\");\n\t\t\t\t\t\t\tres.end();\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tres.statusCode = 200;\n\t\t\t\t\t\t\tres.write(\"Access denied, incorrect password\");\n\t\t\t\t\t\t\tres.end();\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t\t//res.setHeader(\"Content-Type\", \"application/json\");\n\t\t\t\t\t//res.end(JSON.stringify({body: req.body, modlist: _modlist}));\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tres.statusCode = 403;\n\t\t\t\t\tres.write(\"Access denied, incorrect password\");\n\t\t\t\t\tres.end();\n\t\t\t\t}\n\t\t\t}\n\t\t\telse { // if the username does not exist\n\t\t\t\tvar modlist = new Modlist();\n\t\t\t\tmodlist.plugins = req.body.plugins;\n\t\t\t\tmodlist.modlist = req.body.modlist;\n\t\t\t\tmodlist.ini = req.body.ini;\n\t\t\t\tmodlist.prefsini = req.body.prefsini;\n\t\t\t\tmodlist.skse = req.body.skse;\n\t\t\t\tmodlist.enblocal = req.body.enblocal;\n\t\t\t\tmodlist.enb = req.body.enb;\n\t\t\t\tmodlist.game = req.body.game;\n\t\t\t\tmodlist.tag = req.body.tag;\n\t\t\t\tmodlist.timestamp = Date.now();\n\t\t\t\tmodlist.username = req.body.username;\n\t\t\t\tmodlist.password = modlist.generateHash(req.body.password);\n\t\t\t\tmodlist.save(function(saveErr) {\n\t\t\t\t\tif(saveErr) {\n\t\t\t\t\t\tres.statusCode = 500;\n\t\t\t\t\t\tres.end();\n\t\t\t\t\t}\n\t\t\t\t\telse {\n\t\t\t\t\t\tres.statusCode = 200;\n\t\t\t\t\t\tres.end();\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\t//res.setHeader(\"Content-Type\", \"application/json\");\n\t\t\t\t//res.end(JSON.stringify(modlist));\n\t\t\t}\n\t\t});\n\t});\n\tapp.post(\"/fullloadorder\", function(req, res) {\n\t\tModlist.findOne({\"username\": req.body.username}, function(err, _modlist) {\n\t\t\tif(_modlist) { // if the username exists in the db\n\t\t\t\tif(_modlist.validPassword(req.body.password)) {\n\t\t\t\t\t_modlist.plugins = _modlist.updateFile(req.body.plugins, \"plugins\");\n\t\t\t\t\t_modlist.modlist = _modlist.updateFile(req.body.modlisttxt, \"modlist\");\n\t\t\t\t\t_modlist.ini = _modlist.updateFile(req.body.skyrimini, \"ini\");\n\t\t\t\t\t_modlist.prefsini = _modlist.updateFile(req.body.skyrimprefsini, \"prefsini\");\n\t\t\t\t\t_modlist.timestamp = Date.now();\n\t\t\t\t\t_modlist.save(function(saveErr) {\n\t\t\t\t\t\tif(saveErr) {\n\t\t\t\t\t\t\tres.statusCode = 500;\n\t\t\t\t\t\t\tres.end();\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tres.statusCode = 200;\n\t\t\t\t\t\t\tres.end();\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tres.statusCode = 403;\n\t\t\t\t\tres.write(\"Access denied, incorrect password\");\n\t\t\t\t\tres.end();\n\t\t\t\t}\n\t\t\t}\n\t\t\telse { // if the username does not exist\n\t\t\t\tvar modlist = new Modlist();\n\t\t\t\tmodlist.plugins = modlist.updateFile(req.body.plugins, \"plugins\");\n\t\t\t\tmodlist.modlist = modlist.updateFile(req.body.modlisttxt, \"modlist\");\n\t\t\t\tmodlist.ini = modlist.updateFile(req.body.skyrimini, \"ini\");\n\t\t\t\tmodlist.prefsini = modlist.updateFile(req.body.skyrimprefsini, \"prefsini\");\n\t\t\t\tmodlist.username = req.body.username;\n\t\t\t\tmodlist.password = modlist.generateHash(req.body.password);\n\t\t\t\tmodlist.timestamp = Date.now();\n\t\t\t\tmodlist.save(function(saveErr) {\n\t\t\t\t\tif(saveErr) {\n\t\t\t\t\t\tres.statusCode = 500;\n\t\t\t\t\t\tres.end();\n\t\t\t\t\t}\n\t\t\t\t\telse {\n\t\t\t\t\t\tres.statusCode = 200;\n\t\t\t\t\t\tres.end();\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t});\n};\n"],"sourceRoot":"/source/"}