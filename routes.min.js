/*! modwatchapi 15-03-2015 */
module.exports=function(a,b,c,d){a.get("/api/users/count",b(c),function(a,b){Modlist.find({},{_id:1},function(a,c){c?(b.set("Content-Type","text/plain"),b.send(""+c.length)):(b.writeHead(404),b.end())})}),a.get("/api/users/list",b(c),function(a,b){Modlist.find({},{username:1},function(a,c){for(var d=[],e=c.length-1,f=0;e>=0;e--,f++)d[f]=c[e].username;b.set("Content-Type","text/json"),b.send({usernames:d})})}),a.get("/api/script/version",b(c),function(a,b){b.set("Content-Type","text"),b.send(d)}),a.get("/api/user/:username/plugins",b(c),function(a,b){Modlist.findOne({username:a.params.username},{plugins:1},function(a,c){c?(b.setHeader("Content-Type","application/json"),b.end(JSON.stringify(c.plugins))):(b.writeHead(404),b.end())})}),a.get("/api/user/:username/modlist",b(c),function(a,b){Modlist.findOne({username:a.params.username},{modlist:1},function(a,c){c?(b.setHeader("Content-Type","application/json"),b.end(JSON.stringify(c.modlist))):(b.writeHead(404),b.end())})}),a.get("/api/user/:username/ini",b(c),function(a,b){Modlist.findOne({username:a.params.username},{ini:1},function(a,c){c?(b.setHeader("Content-Type","application/json"),b.end(JSON.stringify(c.ini))):(b.writeHead(404),b.end())})}),a.get("/api/user/:username/prefsini",b(c),function(a,b){Modlist.findOne({username:a.params.username},{prefsini:1},function(a,c){c?(b.setHeader("Content-Type","application/json"),b.end(JSON.stringify(c.prefsini))):(b.writeHead(404),b.end())})}),a.get("/api/user/:username/skse",b(c),function(a,b){Modlist.findOne({username:a.params.username},{skse:1},function(a,c){c?(b.setHeader("Content-Type","application/json"),b.end(JSON.stringify(c.skse))):(b.writeHead(404),b.end())})}),a.get("/api/user/:username/enblocal",b(c),function(a,b){Modlist.findOne({username:a.params.username},{enblocal:1},function(a,c){c?(b.setHeader("Content-Type","application/json"),b.end(JSON.stringify(c.enblocal))):(b.writeHead(404),b.end())})}),a.get("/api/user/:username/profile",b(c),function(a,b){Modlist.findOne({username:a.params.username},{tag:1,enb:1,badge:1,timestamp:1,game:1,_id:0},function(a,c){c?(b.setHeader("Content-Type","application/json"),b.end(JSON.stringify(c))):(b.writeHead(404),b.end())})}),a.get("/api/user/:username/files",b(c),function(a,b){Modlist.findOne({username:a.params.username},{plugins:1,modlist:1,ini:1,prefsini:1,skse:1,enblocal:1,_id:0},function(a,c){if(c){b.setHeader("Content-Type","application/json");var d=[];c.plugins.length>0&&d.push("plugins"),c.modlist.length>0&&d.push("modlist"),c.ini.length>0&&d.push("ini"),c.prefsini.length>0&&d.push("prefsini"),c.skse.length>0&&d.push("skse"),c.enblocal.length>0&&d.push("enblocal"),b.end(JSON.stringify(d))}else b.writeHead(404),b.end()})}),a.get("/api/search/modlist/:querystring",b(c),function(a,b){Modlist.find({},{modlist:1,username:1},function(a,c){for(var d,e=[],f=request.params.query.toLowerCase(),g=0;c&&g<c.length;g++)for(var h=0;h<c[g].modlist.length;h++)if(d=c[g].modlist[h].name.toLowerCase(),d.indexOf(f)>=0){e.push(c[g].username);break}b.setHeader("Content-Type","application/json"),b.end(JSON.stringify({users:e,length:e.length}))})})};var Modlist=require("./modlist.min.js");